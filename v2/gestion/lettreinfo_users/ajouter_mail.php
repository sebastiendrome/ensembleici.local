<?phpsession_name("EspacePerso");session_start();require_once "config.php";//On récupère les communautés de communes$req_communaute_commune = "SELECT communautecommune.libelle,communautecommune.no_ville AS no FROM `communautecommune`";$res_communaute_commune = $connexion->prepare($req_communaute_commune) or die("pb prepare");$res_communaute_commune->execute() or die("pb execute");$tab_communaute_commune = $res_communaute_commune->fetchAll();?><html><head><script type="text/javascript" src="../../../js/ckeditor/ckeditor.js"></script></head><body style="text-align:center;"><div class="formA">	<ul>		<fieldset>			<legend>Ajout d'adresse mail</legend><textarea id="les_adresses" style="width:500px;height:300px;background-image:url('img/fond_boite_email.png');border:1px solid grey;border-radius:5px;" onfocus="this.style.backgroundImage='none';"></textarea><select id="cc">			<option value="0" style="text-align:center;">s&eacute;l&eacute;ctionner une communaut&eacute; de communes</option>			<?php			for($i=0;$i<count($tab_communaute_commune);$i++){				?>				<option style="text-indent:20px;" value="<?php echo $tab_communaute_commune[$i]["no"]; ?>"><?php echo $tab_communaute_commune[$i]["libelle"]; ?></option>				<?php			}			?>			</select><input type="button" value="ajouter les adresse" onclick="envoyer_adresse()" />		</fieldset>	</ul></div><script type="text/javascript">	function envoyer_adresse(tab_adresses,v,nbm,nba){		var continuer = true;		if(typeof(tab_adresses)=="undefined"&&typeof(v)=="undefined"&&typeof(nbm)=="undefined"&&typeof(nba)=="undefined"){			var les_adresses = document.getElementById("les_adresses").value;			var v = document.getElementById("cc").value;			var tab_adresses = "";			var nbm = 0;			var nba = 0;			if(les_adresses==""){				alert("vous devez saisir des adresses ! ");				continuer = !continuer;			}			if(v==0){				alert("vous devez choisir une communauté de commune ! ");				continuer = !continuer;			}		}		else{			var les_adresses = "";			tab_adresses = tab_adresses.join(";");		}		if(continuer){			//On envoi les adresses au fichier ajax/ajout_mail.php			var xhr = getXhr();				xhr.open("POST", "ajout_mail_ajax.php", false);				xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');				xhr.send("m="+escape(les_adresses)+"&v="+v+"&t="+escape(tab_adresses)+"&nbm="+nbm+"&nba="+nba);			var reponse = eval("("+xhr.responseText+")");			if(reponse[0]){				if(reponse[1]){ //Ils reste encore le tableau reponse[2] de mails à insérerer					envoyer_adresse(reponse[2]["adresses"],reponse[2]["ville"],reponse[2]["nbm"],reponse[2]["nba"]);				}				else{ //Fin des ajouts					//On ferme la colorbox					parent.$.colorbox.close();					alert("insertion finie ("+reponse[2]["nba"]+" insertions, "+reponse[2]["nbm"]+" modifications)");					document.location = document.location;				}			}			else				alert("une erreur est survenue ! ");		}	}</script></body></html>